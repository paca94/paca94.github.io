I"<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">search</span><span class="pi">:</span> <span class="no">true</span>
</code></pre></div></div>

<p class="notice--info"><strong>Note:</strong> <code class="language-plaintext highlighter-rouge">search: false</code> only works to exclude posts when using Lunr as a search provider.</p>

<p>To exclude files when using Algolia as a search provider add an array to <code class="language-plaintext highlighter-rouge">algolia.files_to_exclude</code> in your <code class="language-plaintext highlighter-rouge">_config.yml</code>. For more configuration options be sure to check their <a href="https://community.algolia.com/jekyll-algolia/options.html">full documentation</a>.</p>

<p>2019년 트위니 회사 시무식에서 이벤트로 모이고 그룹방에서 퀴즈에 대해 정답을 입력하는 이벤트를 진행했다.
해당 이벤트를 진행하던 도중 모이고 서버가 터지는 일이 발생했다. 심지어 모이고 서버는 Erlang으로 작성되어있다.
왜 이런 일이 발생한건지, 원인은 무엇이고 어떻게 이것을 개선했는지에 대한 글이다.</p>

<p>서버가 터졌던 이유중 하나로는 서버가 1대만 떠있었다.
서버가 1대만 떠있던 이유는 당시 모이고 DAU가 매우 적었기 때문에, 비용 절감을 위해 2대 -&gt; 1대로 서버의 수를 줄여놨었다.
비용절감을 위해서라지만, 1대라면, 해당 서버가 죽어버리면, 바로 장애가 일어나게 된다. 애초에 2~3대를 기본적으로 운용했어야 했는데, 해당 부분은 우리팀의 실수였다.
이후, 서버는 상시 2대를 기본 운용하도록 변경하였다.
만약, 2대가 있었다면, 요청분산이 어느정도 될 테니, 서버가 죽진 않았을거라 생각된다.</p>

<p>서버가 터졌던 가장 큰 이유는 모이고 서버의 푸시 전송 방식이 효율적이지 않아서였다.
당시 클라이언트별로 데이터 푸시를 따로 보내고, 알람도 따로 보냈다.
즉, 유저 하나에게 채팅전송시 보내는 푸시는 AOS의 채팅데이터 푸시. IOS 채팅 데이터 푸시. IOS 노티푸시 총 3개였다.
그룹으로 채팅을 보낸다면, 개개인에게 푸시를 각자 전송했었고, 만약, 10명이 있는 방이라면 채팅 1개당 전송되는 푸시의 개수는 30개가 된다. 추가적으로 채팅을 읽었을때도 푸시가 있어서 이런걸 합하면, 50~60명의 유저가 채팅방에 있을 때, 일시에 채팅전송을 시작한다면, 어마어마한 양의 FCM 전송요청이 생긴다.</p>

<ol>
  <li>
    <p>서버가 1대만 떠있었다.</p>
  </li>
  <li>
    <p>푸시 방식이 비효율적이었다.</p>
  </li>
</ol>

<ul>
  <li>서버가 1대만 떠있던이유 ?</li>
</ul>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">algolia</span><span class="pi">:</span>
  <span class="c1"># Exclude more files from indexing</span>
  <span class="na">files_to_exclude</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">index.html</span>
    <span class="pi">-</span> <span class="s">index.md</span>
    <span class="pi">-</span> <span class="s">excluded-file.html</span>
    <span class="pi">-</span> <span class="s">_posts/2017-11-28-post-exclude-search.md</span>
    <span class="pi">-</span> <span class="s">subdirectory/*.html</span>
</code></pre></div></div>
:ET